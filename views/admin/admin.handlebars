<h3>Hello {{user.name}} !!!</h3>

<br>
<br>

<table class="table table-bordered">
  <thead class="table-success">
    <tr>
        <th scope="col">ID</th>
        <th scope="col">Title</th>
        <th scope="col">Status</th>
    </tr>
  </thead>
  <tbody>
{{#each groupedComplaints}}
  <h3>{{@key}} Department</h3>

  <table class="table table-bordered">
    <thead>
      <tr>
        <th>ID</th>
        <th>Title</th>
        <th>Status</th>
      </tr>
    </thead>

    <tbody>
      {{#each this}}
      <tr>
        <td>{{this._id}}</td>

        <td>
          {{this.title}}
          <br><br>
          <button 
            class="btn btn-sm btn-primary"
            type="button"
            onclick="toggleDesc('{{this._id}}')">
            View Description
          </button>
        </td>

        <td>
          <form method="post" action="/updateStatus" style="display:flex; gap:6px;">
            <input type="hidden" name="complaintID" value="{{this._id}}">

            <select name="status" class="form-control form-control-sm">
              <option value="Pending" {{#ifEquals this.status "Pending"}}selected{{/ifEquals}}>Pending</option>
              <option value="In Progress" {{#ifEquals this.status "In Progress"}}selected{{/ifEquals}}>In Progress</option>
              <option value="Resolved" {{#ifEquals this.status "Resolved"}}selected{{/ifEquals}}>Resolved</option>
            </select>

            <button type="submit" class="btn btn-sm btn-success">
              Update
            </button>
          </form>
        </td>
      </tr>

      <tr id="desc-row-{{this._id}}" style="display:none;">
        <td colspan="3">
          <strong>Description:</strong>
          <p>{{this.description}}</p>
        </td>
      </tr>
      {{/each}}
    </tbody>
  </table>
{{/each}}



    
  </tbody>
</table>

<div class="container mt-5 border p-5" style="width:70%">
    <h2> Assign the Complaint to Resolver</h2>
    <br>
    <form method="post" action="/assign">
    <div class="form-group">
        <label>Complaint Number</label>
        <input class="form-control" type="text" name="complaintID" placeholder="Complaint Number">
    </div>
    <div class="form-group">
        <label>Resolver</label>
        <select name="resolverName" id="resolverName" class="form-control">
            {{#each resolver}}
                <option value={{username}}> {{username}} </option>
            {{/each}}
        </select>
    </div>
    <div class="form-group">
        <button type="submit" class="btn btn-success btn-block">Assign to Resolver</button>
    </div>
    </form>
</div>

<script>
function toggleDesc(id, btn) {
    const row = document.getElementById("desc-row-" + id);

    if (row.style.display === "none") {
        row.style.display = "table-row";
        btn.innerText = "Hide Description";
        btn.classList.remove("btn-primary");
        btn.classList.add("btn-secondary");
    } else {
        row.style.display = "none";
        btn.innerText = "View Description";
        btn.classList.remove("btn-secondary");
        btn.classList.add("btn-primary");
    }
}
</script>


