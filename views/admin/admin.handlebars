<h3>Hello {{user.name}} !!!</h3>

{{#each groupedComplaints}}
  <h3>{{@key}} Department</h3>

  <table class="table table-bordered">
    <thead class="table-success">
      <tr>
        <th>ID</th>
        <th>Title</th>
        <th>Status</th>
      </tr>
    </thead>

    <tbody>
      {{#each this}}
      <tr>
        <td>{{this.complaintNo}}</td>

        <td>
          {{this.title}}
          <br><br>

          <button
            class="btn btn-sm btn-primary"
            type="button"
            onclick="toggleDesc('{{this._id}}', this)">
            View Description
          </button>

          <form method="post" action="/assignResolver" style="display:flex; gap:6px; margin-top:6px;">
            <input type="hidden" name="complaintID" value="{{this._id}}">

            <select name="resolverId" class="form-control form-control-sm">
  <          option value="">Assign Resolver</option>
            {{#each ../../resolver}}
            <option value="{{_id}}">{{name}}</option>
            {{/each}}
            </select>


            <button type="submit" class="btn btn-sm btn-warning">
              Assign
            </button>
          </form>

          {{#if this.assignedTo}}
            <small>Assigned to: {{this.assignedTo.name}}</small>
          {{else}}
            <small>Not assigned</small>
          {{/if}}
        </td>

        <td>
          <form method="post" action="/updateStatus" style="display:flex; gap:6px;">
            <input type="hidden" name="complaintID" value="{{this._id}}">

            <select name="status" class="form-control form-control-sm">
              <option value="Pending" {{#ifEquals this.status "Pending"}}selected{{/ifEquals}}>Pending</option>
              <option value="In Progress" {{#ifEquals this.status "In Progress"}}selected{{/ifEquals}}>In Progress</option>
              <option value="Resolved" {{#ifEquals this.status "Resolved"}}selected{{/ifEquals}}>Resolved</option>
            </select>

            <button type="submit" class="btn btn-sm btn-success">
              Update
            </button>
          </form>
        </td>
      </tr>

      <tr id="desc-row-{{this._id}}" style="display:none;">
        <td colspan="3">
          <strong>Description:</strong>
          <p>{{this.description}}</p>
        </td>
      </tr>
      {{/each}}
    </tbody>
  </table>
{{/each}}

<script>
function toggleDesc(id, btn) {
  const row = document.getElementById("desc-row-" + id);

  if (!row) {
    console.log("Description row not found for:", id);
    return;
  }

  if (row.style.display === "none") {
    row.style.display = "table-row";
    btn.innerText = "Hide Description";
    btn.classList.remove("btn-primary");
    btn.classList.add("btn-secondary");
  } else {
    row.style.display = "none";
    btn.innerText = "View Description";
    btn.classList.remove("btn-secondary");
    btn.classList.add("btn-primary");
  }
}
</script>
